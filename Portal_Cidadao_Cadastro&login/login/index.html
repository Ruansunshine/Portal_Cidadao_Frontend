<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Saúde Pública - Login</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#3b82f6',
                        'primary-dark': '#2563eb',
                        'primary-light': '#dbeafe',
                        'success': '#10b981',
                        'warning': '#f59e0b',
                        'error': '#ef4444',
                        'neutral-light': '#f8fafc',
                        'neutral-medium': '#e2e8f0',
                        'neutral-dark': '#64748b'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-neutral-light min-h-screen flex items-center justify-center p-4">
    <!-- Container principal -->
    <div class="w-full max-w-5xl bg-white rounded-lg shadow-lg overflow-hidden flex flex-col md:flex-row">

        <!-- Seção de boas-vindas (lado esquerdo em desktop, topo em mobile) -->
        <div
            class="bg-gradient-to-br from-primary to-primary-dark text-white p-8 md:p-12 md:w-1/2 flex flex-col justify-center">
            <div class="mb-6">
                <!-- Logo do Sistema -->
                <div class="flex items-center mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mr-3" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                    </svg>
                    <h1 class="text-2xl font-bold">Sistema de Saúde Pública</h1>
                </div>

                <!-- Mensagem de boas-vindas -->
                <h2 class="text-3xl font-bold mb-4">Bem-vindo ao Sistema de Saúde</h2>
                <p class="text-lg opacity-90 mb-6">
                    Acesse informações sobre serviços de saúde, agende consultas e acompanhe seu histórico médico.
                </p>

                <!-- Benefícios do sistema -->
                <ul class="space-y-3 opacity-90">
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 mt-0.5" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Agende consultas médicas, vacinas e exames
                    </li>
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 mt-0.5" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Verifique a lotação das unidades em tempo real
                    </li>
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 mt-0.5" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Visualize rotas de transporte para unidades de saúde
                    </li>
                    <li class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 mt-0.5" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Configure alertas e lembretes para suas consultas
                    </li>
                </ul>
            </div>

            <!-- Imagem ilustrativa (removido o texto "Ilustração de serviços de saúde") -->
            <div class="mt-8 hidden md:block">
                <img src="/placeholder.svg?height=200&width=300" alt="" class="max-w-full rounded-lg opacity-90">
            </div>
        </div>

        <!-- Formulário de login (lado direito em desktop, abaixo em mobile) -->
        <div class="p-8 md:p-12 md:w-1/2 flex flex-col justify-center">
            <div>
                <!-- Cabeçalho do formulário -->
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Acesse sua conta</h2>
                <p class="text-neutral-dark mb-8">
                    Informe seus dados para acessar o sistema
                </p>

                <!-- Formulário de login -->
                <form id="loginForm" method="POST" class="space-y-6">
                    <!-- Campo de CPF -->
                    <div>
                        <label for="cpf" class="block text-sm font-medium text-gray-700 mb-1">
                            CPF
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <input id="cpf" name="cpf" type="text" autocomplete="cpf" placeholder="000.000.000-00"
                                required
                                class="pl-10 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20 transition duration-150 py-2 px-3 border"
                                aria-describedby="cpf-description" maxlength="14">
                        </div>
                        <p id="cpf-description" class="mt-1 text-sm text-neutral-dark">
                            Digite apenas os números do seu CPF
                        </p>
                        <p id="cpf-error" class="mt-1 text-sm text-error hidden">
                            Por favor, preencha o CPF corretamente
                        </p>
                    </div>

                    <!-- Campo de senha -->
                    <div>
                        <div class="flex items-center justify-between">
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">
                                Senha
                            </label>
                            <a href="/esqueci-senha"
                                class="text-sm text-primary hover:text-primary-dark transition duration-150">
                                Esqueci minha senha
                            </a>
                        </div>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </div>
                            <input id="password" name="password" type="password" autocomplete="current-password"
                                required placeholder="••••••••"
                                class="pl-10 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20 transition duration-150 py-2 px-3 border">
                        </div>
                        <p id="password-error" class="mt-1 text-sm text-error hidden">
                            Por favor, preencha a senha
                        </p>
                    </div>

                    <!-- Checkbox "Lembrar de mim" -->
                    <div class="flex items-center">
                        <input id="remember-me" name="remember-me" type="checkbox"
                            class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                        <label for="remember-me" class="ml-2 block text-sm text-gray-700">
                            Lembrar de mim
                        </label>
                    </div>

                    <!-- Botão de entrar -->
                    <div>
                        <button type="submit"
                            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition duration-150">
                            Entrar
                        </button>
                    </div>
                </form>

                <!-- Links adicionais -->
                <div class="mt-6 text-center">
                    <p class="text-sm text-neutral-dark">
                        Não tem cadastro?
                        <a href="../cadastro/index.html"
                            class="font-medium text-primary hover:text-primary-dark transition duration-150">
                            Cadastre-se aqui
                        </a>
                    </p>
                </div>

                <!-- Ajuda e suporte -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <div class="flex items-center justify-center space-x-4">
                        <a href="/ajuda"
                            class="text-sm text-neutral-dark hover:text-primary flex items-center transition duration-150">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            Ajuda
                        </a>
                        <a href="/contato"
                            class="text-sm text-neutral-dark hover:text-primary flex items-center transition duration-150">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path
                                    d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                                </path>
                            </svg>
                            Contato
                        </a>
                        <a href="/acessibilidade"
                            class="text-sm text-neutral-dark hover:text-primary flex items-center transition duration-150">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 8v4"></path>
                                <path d="M12 16h.01"></path>
                            </svg>
                            Acessibilidade
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Botão de acessibilidade flutuante -->
    <div class="fixed bottom-4 right-4">
        <button
            class="bg-white p-3 rounded-full shadow-lg text-primary hover:text-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition duration-150">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 8v4"></path>
                <path d="M12 16h.01"></path>
            </svg>
            <span class="sr-only">Opções de acessibilidade</span>
        </button>
    </div>

    <!-- Script para validação do CPF -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cpfInput = document.getElementById('cpf');
            const cpfError = document.getElementById('cpf-error');
            const passwordInput = document.getElementById('password');
            const passwordError = document.getElementById('password-error');
            const form = document.getElementById('loginForm');

            // Formatar CPF enquanto digita (000.000.000-00)
            cpfInput.addEventListener('input', function (e) {
                let value = e.target.value;

                // Remove todos os caracteres não numéricos
                value = value.replace(/\D/g, '');

                // Aplica a máscara de CPF
                if (value.length <= 11) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                }

                // Atualiza o valor do campo
                e.target.value = value;

                // Esconde a mensagem de erro quando o usuário começa a digitar
                cpfError.classList.add('hidden');
            });

            // Validação do formulário no envio
            form.addEventListener('submit', function (e) {
                let isValid = true;

                // Validar CPF
                const cpfValue = cpfInput.value.replace(/\D/g, '');
                if (cpfValue.length !== 11) {
                    cpfError.classList.remove('hidden');
                    cpfInput.classList.add('border-error');
                    isValid = false;
                } else {
                    cpfError.classList.add('hidden');
                    cpfInput.classList.remove('border-error');
                }

                // Validar senha
                if (!passwordInput.value) {
                    passwordError.classList.remove('hidden');
                    passwordInput.classList.add('border-error');
                    isValid = false;
                } else {
                    passwordError.classList.add('hidden');
                    passwordInput.classList.remove('border-error');
                }

                // Impedir envio se não for válido
                if (!isValid) {
                    e.preventDefault();
                }
            });
        });


        document.addEventListener('DOMContentLoaded', function () {
            const cpfInput = document.getElementById('cpf');
            const cpfError = document.getElementById('cpf-error');
            const passwordInput = document.getElementById('password');
            const passwordError = document.getElementById('password-error');
            const form = document.getElementById('loginForm');

            cpfInput.addEventListener('input', function (e) {
                let value = e.target.value;
                value = value.replace(/\D/g, '');
                if (value.length <= 11) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                }
                e.target.value = value;
                cpfError.classList.add('hidden');
            });

            form.addEventListener('submit', function (e) {
                e.preventDefault(); // Impede o envio tradicional do formulário

                let isValid = true;

                const cpfValue = cpfInput.value.replace(/\D/g, '');
                if (cpfValue.length !== 11) {
                    cpfError.classList.remove('hidden');
                    cpfInput.classList.add('border-error');
                    isValid = false;
                } else {
                    cpfError.classList.add('hidden');
                    cpfInput.classList.remove('border-error');
                }

                if (!passwordInput.value) {
                    passwordError.classList.remove('hidden');
                    passwordInput.classList.add('border-error');
                    isValid = false;
                } else {
                    passwordError.classList.add('hidden');
                    passwordInput.classList.remove('border-error');
                }

                if (!isValid) return;

                // Requisição ao backend
                fetch('http://localhost:3000/router/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cpf: cpfValue,
                        password: passwordInput.value
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.token) {
                            const token = data.token;
                            const user = encodeURIComponent(JSON.stringify(data.Users));

                            // Redireciona com token e user na URL
                            window.location.href = `http://localhost:3001/?token=${token}&user=${user}`;
                        

                    } else if (data.error) {
                        alert(data.error); // Exibe erro vindo do backend
                    } else {
                    alert('Erro desconhecido ao tentar logar.');
                }
            })
                .catch(err => {
                    console.error('Erro na requisição:', err);
                    alert('Erro ao conectar com o servidor.');
                });
        });
            });

    </script>
</body>

</html>